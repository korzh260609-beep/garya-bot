# SG (–°–æ–≤–µ—Ç–Ω–∏–∫ GARYA)

[![SG Minimal CI](https://github.com/korzh260609-beep/garya-bot/actions/workflows/ci.yml/badge.svg?branch=main)](https://github.com/korzh260609-beep/garya-bot/actions/workflows/ci.yml)

SG (–°–æ–≤–µ—Ç–Ω–∏–∫ GARYA) ‚Äî –º–æ–¥—É–ª—å–Ω—ã–π —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –∏ Task Engine-—Å–∏—Å—Ç–µ–º–∞, –ø–æ—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –ø–æ –ø—Ä–∏–Ω—Ü–∏–ø—É identity-first –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –∏ —Å—Ç—Ä–æ–≥–æ–π —ç—Ç–∞–ø–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏.

SG –ø—Ä–æ–µ–∫—Ç–∏—Ä—É–µ—Ç—Å—è –∫–∞–∫ –º—É–ª—å—Ç–∏–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω–∞—è decision-support —Å–∏—Å—Ç–µ–º–∞.  
Telegram –Ω–∞ —Ç–µ–∫—É—â–µ–º —ç—Ç–∞–ø–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ transport layer, –∞ –Ω–µ –∫–∞–∫ –æ—Å–Ω–æ–≤–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã.

---

## üèó –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

- Node.js (ESM)
- Express ‚Äî HTTP / Webhook
- PostgreSQL ‚Äî –ø–∞–º—è—Ç—å, –∑–∞–¥–∞—á–∏, access-requests
- Telegram ‚Äî —Ç–µ–∫—É—â–∏–π —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç
- Render ‚Äî —Ö–æ—Å—Ç–∏–Ω–≥
- GitHub Actions ‚Äî CI
- –ú–æ–¥—É–ª—å–Ω–∞—è AI-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

---

## üîë –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

- Identity-first (–º–æ–Ω–∞—Ä—Ö –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ `process.env.MONARCH_USER_ID`)
- –ù–∏–∫–∞–∫–æ–≥–æ –¥–æ–≤–µ—Ä–∏—è –∫ `chat_id`
- `senderIdStr (msg.from.id)` ‚Äî source of truth
- –ñ—ë—Å—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Å–ª–æ—ë–≤ (Transport / Core / Sources / AI)
- Source-first –ø–æ–¥—Ö–æ–¥
- –°—Ç—Ä–æ–≥–∞—è —ç—Ç–∞–ø–Ω–æ—Å—Ç—å (ROADMAP + WORKFLOW)
- 1 —à–∞–≥ = 1 –¥–µ–π—Å—Ç–≤–∏–µ
- –ù–∏–∫–∞–∫–æ–π –∞–≤—Ç–æ–¥–µ–ø–ª–æ–π –±–µ–∑ –∫–æ–Ω—Ç—Ä–æ–ª—è –º–æ–Ω–∞—Ä—Ö–∞
- DEV-GATE: –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã —Ä–∞–±–æ—Ç–∞—é—Ç —Ç–æ–ª—å–∫–æ –≤ –ª–∏—á–Ω–æ–º —á–∞—Ç–µ –º–æ–Ω–∞—Ä—Ö–∞

---

## ‚öô –û—Å–Ω–æ–≤–Ω—ã–µ –º–æ–¥—É–ª–∏

### üß† Core / Task Engine

- –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á
- –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ AI
- –°—Ç–∞—Ç—É—Å—ã: active / paused / deleted
- –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
- –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—é (JobRunner skeleton)

–ö–æ–º–∞–Ω–¥—ã:

/tasks  
/newtask <title> | <note>  
/run <id>  
/stop_tasks_type  

---

### üåê Sources Layer

–£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö.

–ö–æ–º–∞–Ω–¥—ã:

/sources  
/sources_diag  
/source <key>  
/diag_source <key>  

---

### üìÇ GitHub Integration (Read-only)

–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–º:

/reindex  
/repo_tree  
/repo_status  
/repo_search  
/repo_analyze  
/repo_review  
/repo_diff  

–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è snapshot-–∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è –∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Ñ–∞–π–ª–æ–≤.  
–ó–∞–ø–∏—Å—å –∫–æ–¥–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –æ—Ç–∫–ª—é—á–µ–Ω–∞ (manual apply only).

---

### üîê Identity & Access

–ú–æ–Ω–∞—Ä—Ö –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è —Å—Ç—Ä–æ–≥–æ —á–µ—Ä–µ–∑ ENV:

MONARCH_USER_ID

Access-request workflow:

/approve <id>  
/deny <id>  
/ar_list  
/ar_create_test  

–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –∑–∞—â–∏—â–µ–Ω—ã:
- –¥–æ—Å—Ç—É–ø–Ω—ã —Ç–æ–ª—å–∫–æ –º–æ–Ω–∞—Ä—Ö—É (—á–µ—Ä–µ–∑ bypassPermissions –∏–ª–∏ —Ä–æ–ª—å monarch)
- guest –ø–æ–ª—É—á–∞–µ—Ç access request
- `cmd.admin.*` –∑–∞–ø—Ä–µ—â–µ–Ω—ã –≤—Å–µ–º –∫—Ä–æ–º–µ –º–æ–Ω–∞—Ä—Ö–∞
- DEV-GATE: –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ –ª–∏—á–Ω–æ–º —á–∞—Ç–µ –º–æ–Ω–∞—Ä—Ö–∞

Identity –ª–æ–≥–∏–∫–∞ –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç transport (–≥—Ä—É–ø–ø–∞/–ª–∏—á–∫–∞/–±—É–¥—É—â–∏–µ –∫–∞–Ω–∞–ª—ã).

---

## üö¶ Rate Limit

–î–ª—è non-monarch –∫–æ–º–∞–Ω–¥ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è in-memory rate limit.

ENV:

CMD_RL_WINDOW_MS=20000  
CMD_RL_MAX=6  

–ú–æ–Ω–∞—Ä—Ö (bypassPermissions) –Ω–µ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç—Å—è rate-limit.

---

## üîê Environment Variables

–§–∞–π–ª `.env.example` –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –∫–æ—Ä–Ω–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –∏ —Å–æ–¥–µ—Ä–∂–∏—Ç —à–∞–±–ª–æ–Ω –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö.

–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ:

BOT_TOKEN=  
DATABASE_URL=  
MONARCH_USER_ID=  

–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ:

CMD_RL_WINDOW_MS=20000  
CMD_RL_MAX=6  
NODE_ENV=production  
PORT=3000  

–§–∞–π–ª `.env` –Ω–µ –∫–æ–º–º–∏—Ç–∏—Ç—Å—è.

---

## üöÄ CI

GitHub Actions workflow:

- –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ (`node --check`)
- –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –ø—Ä–∏ push –≤ `main`

CI –∑–∞—â–∏—â–∞–µ—Ç –ø—Ä–æ–µ–∫—Ç –æ—Ç —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫.

---

## üìå –°—Ç–∞—Ç—É—Å –ø—Ä–æ–µ–∫—Ç–∞

Stage-based –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞.  
Transport –º–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞–º–µ–Ω—ë–Ω –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è Core.

---

## üëë –ê–≤—Ç–æ—Ä

Monarch: GARYA

---

SG ‚Äî —ç—Ç–æ —É–ø—Ä–∞–≤–ª—è–µ–º–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Å –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º–æ–π —ç–≤–æ–ª—é—Ü–∏–µ–π.
